(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.KintoClient = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

},{}],2:[function(require,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,i,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(isObject(n))for(s=Array.prototype.slice.call(arguments,1),o=n.slice(),i=o.length,r=0;i>r;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,i,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=s;r-- >0;)if(n[r]===t||n[r].listener&&n[r].listener===t){i=r;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};

},{}],3:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _applyDecoratedDescriptor(e,t,r,s,n){var i={};return Object.keys(s).forEach(function(e){i[e]=s[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,s){return s(e,t,r)||r},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=exports.SUPPORTED_PROTOCOL_VERSION=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),_dec,_dec2,_dec3,_dec4,_dec5,_dec6,_desc,_value,_class,_utils=require("./utils"),_http=require("./http"),_http2=_interopRequireDefault(_http),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_batch=require("./batch"),_bucket=require("./bucket"),_bucket2=_interopRequireDefault(_bucket),SUPPORTED_PROTOCOL_VERSION=exports.SUPPORTED_PROTOCOL_VERSION="v1",KintoClientBase=(_dec=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec2=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec3=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec4=(0,_utils.nobatch)("This operation is not supported within a batch operation."),_dec5=(0,_utils.nobatch)("Can't use batch within a batch!"),_dec6=(0,_utils.support)("1.4","2.0"),_class=function(){function e(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(_classCallCheck(this,e),"string"!=typeof t||!t.length)throw new Error("Invalid remote URL: "+t);"/"===t[t.length-1]&&(t=t.slice(0,-1)),this._backoffReleaseTime=null,this.defaultReqOptions={bucket:r.bucket||"default",headers:r.headers||{},safe:!!r.safe},this._options=r,this._requests=[],this._isBatch=!!r.batch,this.remote=t,this.serverInfo=null,this.events=r.events;var s=r.requestMode,n=r.timeout;this.http=new _http2["default"](this.events,{requestMode:s,timeout:n}),this._registerHTTPEvents()}return _createClass(e,[{key:"_registerHTTPEvents",value:function(){var e=this;this._isBatch||this.events.on("backoff",function(t){e._backoffReleaseTime=t})}},{key:"bucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=(0,_utils.omit)(this._getRequestOptions(t),"bucket");return new _bucket2["default"](this,e,r)}},{key:"_getRequestOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _extends({},this.defaultReqOptions,e,{batch:this._isBatch,headers:_extends({},this.defaultReqOptions.headers,e.headers)})}},{key:"fetchServerInfo",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.serverInfo?Promise.resolve(this.serverInfo):this.http.request(this.remote+(0,_endpoint2["default"])("root"),{headers:_extends({},this.defaultReqOptions.headers,t.headers)}).then(function(t){var r=t.json;return e.serverInfo=r,e.serverInfo})}},{key:"fetchServerSettings",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.fetchServerInfo(e).then(function(e){var t=e.settings;return t})}},{key:"fetchServerCapabilities",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.fetchServerInfo(e).then(function(e){var t=e.capabilities;return t})}},{key:"fetchUser",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.fetchServerInfo(e).then(function(e){var t=e.user;return t})}},{key:"fetchHTTPApiVersion",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.fetchServerInfo(e).then(function(e){var t=e.http_api_version;return t})}},{key:"_batchRequests",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=_extends({},this.defaultReqOptions.headers,r.headers);return e.length?this.fetchServerSettings().then(function(n){var i=n.batch_max_requests;if(i&&e.length>i){var a=(0,_utils.partition)(e,i);return(0,_utils.pMap)(a,function(e){return t._batchRequests(e,r)})}return t.execute({path:(0,_endpoint2["default"])("batch"),method:"POST",headers:s,body:{defaults:{headers:s},requests:e}}).then(function(e){var t=e.responses;return t})}):Promise.resolve([])}},{key:"batch",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=new e(this.remote,_extends({},this._options,this._getRequestOptions(r),{batch:!0})),n=void 0,i=void 0;r.bucket&&(n=s.bucket(r.bucket),r.collection&&(i=n.collection(r.collection)));var a=i||n||s;try{t(a)}catch(o){return Promise.reject(o)}return this._batchRequests(s._requests,r).then(function(e){return r.aggregate?(0,_batch.aggregate)(e,s._requests):e})}},{key:"execute",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?{raw:!1}:arguments[1];if(this._isBatch){this._requests.push(e);var s="This result is generated from within a batch operation and should not be consumed.";return Promise.resolve(r.raw?{json:s}:s)}var n=this.fetchServerSettings().then(function(r){return t.http.request(t.remote+e.path,_extends({},e,{body:JSON.stringify(e.body)}))});return r.raw?n:n.then(function(e){var t=e.json;return t})}},{key:"listBuckets",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.execute({path:(0,_endpoint2["default"])("bucket"),headers:_extends({},this.defaultReqOptions.headers,e.headers)})}},{key:"createBucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!e)throw new Error("A bucket id is required.");var r=this._getRequestOptions(t),s=r.data,n=void 0===s?{}:s,i=r.permissions;n.id=e;var a=(0,_endpoint2["default"])("bucket",e);return this.execute(requests.createRequest(a,{data:n,permissions:i},r))}},{key:"deleteBucket",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=(0,_utils.toDataBody)(e);if(!r.id)throw new Error("A bucket id is required.");var s=(0,_endpoint2["default"])("bucket",r.id),n={bucketObj:r},i=n.last_modified,a=this._getRequestOptions(_extends({last_modified:i},t));return this.execute(requests.deleteRequest(s,a))}},{key:"deleteBuckets",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._getRequestOptions(e),r=(0,_endpoint2["default"])("bucket");return this.execute(requests.deleteRequest(r,t))}},{key:"remote",get:function(){return this._remote},set:function(e){var t=void 0;try{t=e.match(/\/(v\d+)\/?$/)[1]}catch(r){throw new Error("The remote URL must contain the version: "+e)}if(t!==SUPPORTED_PROTOCOL_VERSION)throw new Error("Unsupported protocol version: "+t);this._remote=e,this._version=t}},{key:"version",get:function(){return this._version}},{key:"backoff",get:function(){var e=(new Date).getTime();return this._backoffReleaseTime&&e<this._backoffReleaseTime?this._backoffReleaseTime-e:0}}]),e}(),_applyDecoratedDescriptor(_class.prototype,"fetchServerSettings",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerSettings"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchServerCapabilities",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"fetchServerCapabilities"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchUser",[_dec3],Object.getOwnPropertyDescriptor(_class.prototype,"fetchUser"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"fetchHTTPApiVersion",[_dec4],Object.getOwnPropertyDescriptor(_class.prototype,"fetchHTTPApiVersion"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"batch",[_dec5],Object.getOwnPropertyDescriptor(_class.prototype,"batch"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"deleteBuckets",[_dec6],Object.getOwnPropertyDescriptor(_class.prototype,"deleteBuckets"),_class.prototype),_class);exports["default"]=KintoClientBase;

},{"./batch":4,"./bucket":5,"./endpoint":7,"./http":9,"./requests":11,"./utils":12}],4:[function(require,module,exports){
"use strict";function aggregate(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(e.length!==t.length)throw new Error("Responses length should match requests one.");var r={errors:[],published:[],conflicts:[],skipped:[]};return e.reduce(function(e,r,s){var o=r.status;return o>=200&&400>o?e.published.push(r.body):404===o?e.skipped.push(r.body):412===o?e.conflicts.push({type:"outgoing",local:t[s].body,remote:r.body.details&&r.body.details.existing||null}):e.errors.push({path:r.path,sent:t[s],error:r.body}),e},r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.aggregate=aggregate;

},{}],5:[function(require,module,exports){
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),_utils=require("./utils"),_collection=require("./collection"),_collection2=_interopRequireDefault(_collection),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Bucket=function(){function e(t,n){var s=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];_classCallCheck(this,e),this.client=t,this.name=n,this.options=s,this._isBatch=!!s.batch}return _createClass(e,[{key:"_bucketOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=_extends({},this.options&&this.options.headers,e.headers);return _extends({},this.options,e,{headers:t,bucket:this.name,batch:this._isBatch})}},{key:"collection",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new _collection2["default"](this.client,this,e,this._bucketOptions(t))}},{key:"getData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("bucket",this.name),headers:_extends({},this.options.headers,e.headers)}).then(function(e){return e.data})}},{key:"setData",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A bucket object is required.");var n=_extends({},e,{id:this.name}),s=n.id;"default"===n.id&&delete n.id;var i=(0,_endpoint2["default"])("bucket",s),r=t.permissions,u=_extends({},this._bucketOptions(t)),a=requests.updateRequest(i,{data:n,permissions:r},u);return this.client.execute(a)}},{key:"listCollections",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("collection",this.name),headers:_extends({},this.options.headers,e.headers)})}},{key:"createCollection",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this._bucketOptions(t),s=n.permissions,i=n.data,r=void 0===i?{}:i;r.id=e;var u=(0,_endpoint2["default"])("collection",this.name,e),a=requests.createRequest(u,{data:r,permissions:s},n);return this.client.execute(a)}},{key:"deleteCollection",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=(0,_utils.toDataBody)(e);if(!n.id)throw new Error("A collection id is required.");var s=n.id,i=n.last_modified,r=this._bucketOptions(_extends({last_modified:i},t)),u=(0,_endpoint2["default"])("collection",this.name,s),a=requests.deleteRequest(u,r);return this.client.execute(a)}},{key:"listGroups",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("group",this.name),headers:_extends({},this.options.headers,e.headers)})}},{key:"getGroup",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.client.execute({path:(0,_endpoint2["default"])("group",this.name,e),headers:_extends({},this.options.headers,t.headers)})}},{key:"createGroup",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=this._bucketOptions(n),i=_extends({},n.data,{id:e,members:t}),r=(0,_endpoint2["default"])("group",this.name,e),u=n.permissions,a=requests.createRequest(r,{data:i,permissions:u},s);return this.client.execute(a)}},{key:"updateGroup",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A group object is required.");if(!e.id)throw new Error("A group id is required.");var n=this._bucketOptions(t),s=_extends({},t.data,e),i=(0,_endpoint2["default"])("group",this.name,e.id),r=t.permissions,u=requests.updateRequest(i,{data:s,permissions:r},n);return this.client.execute(u)}},{key:"deleteGroup",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=(0,_utils.toDataBody)(e),s=n.id,i=n.last_modified,r=this._bucketOptions(_extends({last_modified:i},t)),u=(0,_endpoint2["default"])("group",this.name,s),a=requests.deleteRequest(u,r);return this.client.execute(a)}},{key:"getPermissions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.client.execute({path:(0,_endpoint2["default"])("bucket",this.name),headers:_extends({},this.options.headers,e.headers)}).then(function(e){return e.permissions})}},{key:"setPermissions",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A permissions object is required.");var n=(0,_endpoint2["default"])("bucket",this.name),s=_extends({},this._bucketOptions(t)),i=t.last_modified,r={last_modified:i},u=requests.updateRequest(n,{data:r,permissions:e},s);return this.client.execute(u)}},{key:"batch",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.client.batch(e,this._bucketOptions(t))}}]),e}();exports["default"]=Bucket;

},{"./collection":6,"./endpoint":7,"./requests":11,"./utils":12}],6:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_utils=require("./utils"),_requests=require("./requests"),requests=_interopRequireWildcard(_requests),_endpoint=require("./endpoint"),_endpoint2=_interopRequireDefault(_endpoint),Collection=function(){function e(t,n,r){var i=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];_classCallCheck(this,e),this.client=t,this.bucket=n,this.name=r,this.options=_extends({},this.bucket.options,i,{headers:_extends({},this.bucket.options&&this.bucket.options.headers,i.headers)}),this._isBatch=!!i.batch}return _createClass(e,[{key:"_collOptions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=_extends({},this.options&&this.options.headers,e.headers);return _extends({},this.options,e,{headers:t})}},{key:"getData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._collOptions(e),n=t.headers;return this.client.execute({path:(0,_endpoint2["default"])("collection",this.bucket.name,this.name),headers:n}).then(function(e){return e.data})}},{key:"setData",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A collection object is required.");var n=this._collOptions(t),r=n.permissions,i=(0,_endpoint2["default"])("collection",this.bucket.name,this.name),s=requests.updateRequest(i,{data:e,permissions:r},n);return this.client.execute(s)}},{key:"getPermissions",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this._collOptions(e),n=t.headers;return this.client.execute({path:(0,_endpoint2["default"])("collection",this.bucket.name,this.name),headers:n}).then(function(e){return e.permissions})}},{key:"setPermissions",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A permissions object is required.");var n=this._collOptions(t),r=(0,_endpoint2["default"])("collection",this.bucket.name,this.name),i={last_modified:t.last_modified},s=requests.updateRequest(r,{data:i,permissions:e},n);return this.client.execute(s)}},{key:"createRecord",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this._collOptions(t),r=n.permissions,i=(0,_endpoint2["default"])("record",this.bucket.name,this.name,e.id),s=requests.createRequest(i,{data:e,permissions:r},n);return this.client.execute(s)}},{key:"updateRecord",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(0,_utils.isObject)(e))throw new Error("A record object is required.");if(!e.id)throw new Error("A record id is required.");var n=this._collOptions(t),r=n.permissions,i=(0,_endpoint2["default"])("record",this.bucket.name,this.name,e.id),s=requests.updateRequest(i,{data:e,permissions:r},n);return this.client.execute(s)}},{key:"deleteRecord",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=(0,_utils.toDataBody)(e);if(!n.id)throw new Error("A record id is required.");var r=n.id,i=n.last_modified,s=this._collOptions(_extends({last_modified:i},t)),a=(0,_endpoint2["default"])("record",this.bucket.name,this.name,r),o=requests.deleteRequest(a,s);return this.client.execute(o)}},{key:"getRecord",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.client.execute(_extends({path:(0,_endpoint2["default"])("record",this.bucket.name,this.name,e)},this._collOptions(t)))}},{key:"listRecords",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.client.http,n=_extends({sort:"-last_modified"},e),r=n.sort,i=n.filters,s=n.limit,a=n.pages,o=n.since;if(o&&"string"!=typeof o)throw new Error("Invalid value for since ("+o+"), should be ETag value.");var u=this.options.headers,l=(0,_endpoint2["default"])("record",this.bucket.name,this.name),c=(0,_utils.qsify)(_extends({},i,{_sort:r,_limit:s,_since:o})),d=[],h=0,m=function(e){if(!e)throw new Error("Pagination exhausted.");return f(e)},f=function(e){return t.request(e,{headers:u}).then(_)},p=function(e,t,n){return{last_modified:n,data:e,next:m.bind(null,t)}},_=function(e){var t=e.headers,n=e.json,r=t.get("Next-Page"),i=t.get("ETag");return a?(d=d.concat(n.data),h+=1,h>=a||!r?p(d,r,i):f(r)):p(n.data,r,i)};return this.client.execute(_extends({path:l+"?"+c},this._collOptions(e)),{raw:!0}).then(_)}},{key:"batch",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this._collOptions(t);return this.client.batch(e,_extends({},n,{bucket:this.bucket.name,collection:this.name}))}}]),e}();exports["default"]=Collection;

},{"./endpoint":7,"./requests":11,"./utils":12}],7:[function(require,module,exports){
"use strict";function endpoint(t){for(var r=arguments.length,e=Array(r>1?r-1:0),n=1;r>n;n++)e[n-1]=arguments[n];return ENDPOINTS[t].apply(ENDPOINTS,e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=endpoint;var ENDPOINTS={root:function(){return"/"},batch:function(){return"/batch"},bucket:function(t){return"/buckets"+(t?"/"+t:"")},collection:function(t,r){return ENDPOINTS.bucket(t)+"/collections"+(r?"/"+r:"")},group:function(t,r){return ENDPOINTS.bucket(t)+"/groups"+(r?"/"+r:"")},record:function(t,r,e){return ENDPOINTS.collection(t,r)+"/records"+(e?"/"+e:"")}};

},{}],8:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={104:"Missing Authorization Token",105:"Invalid Authorization Token",106:"Request body was not valid JSON",107:"Invalid request parameter",108:"Missing request parameter",109:"Invalid posted data",110:"Invalid Token / id",111:"Missing Token / id",112:"Content-Length header was not provided",113:"Request body too large",114:"Resource was modified meanwhile",115:"Method not allowed on this end point",116:"Requested version not available on this server",117:"Client has sent too many requests",121:"Resource access is forbidden for this user",122:"Another resource violates constraint",201:"Service Temporary unavailable due to high load",202:"Service deprecated",999:"Internal Server Error"};

},{}],9:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_errors=require("./errors"),_errors2=_interopRequireDefault(_errors),HTTP=function(){function e(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(_classCallCheck(this,e),!t)throw new Error("No events handler provided");this.events=t,this.requestMode=r.requestMode||e.defaultOptions.requestMode,this.timeout=r.timeout||e.defaultOptions.timeout}return _createClass(e,null,[{key:"DEFAULT_REQUEST_HEADERS",get:function(){return{Accept:"application/json","Content-Type":"application/json"}}},{key:"defaultOptions",get:function(){return{timeout:5e3,requestMode:"cors"}}}]),_createClass(e,[{key:"request",value:function(t){var r=this,n=arguments.length<=1||void 0===arguments[1]?{headers:{}}:arguments[1],o=void 0,a=void 0,s=void 0,i=void 0,u=void 0;return n.headers=Object.assign({},e.DEFAULT_REQUEST_HEADERS,n.headers),n.mode=this.requestMode,new Promise(function(e,o){var a=setTimeout(function(){u=!0,o(new Error("Request timeout."))},r.timeout);fetch(t,n).then(function(t){u||(clearTimeout(a),e(t))})["catch"](function(e){u||(clearTimeout(a),o(e))})}).then(function(e){return o=e,i=e.headers,a=e.status,s=e.statusText,r._checkForDeprecationHeader(i),r._checkForBackoffHeader(a,i),r._checkForRetryAfterHeader(a,i),e.text()}).then(function(e){return 0===e.length?null:JSON.parse(e)})["catch"](function(e){var t=new Error("HTTP "+(a||0)+"; "+e);throw t.response=o,t.stack=e.stack,t}).then(function(e){if(e&&a>=400){var t="HTTP "+a+" "+(e.error||"")+": ";if(e.errno&&e.errno in _errors2["default"]){var r=_errors2["default"][e.errno];t+=r,e.message&&e.message!==r&&(t+=" ("+e.message+")")}else t+=s||"";var n=new Error(t.trim());throw n.response=o,n.data=e,n}return{status:a,json:e,headers:i}})}},{key:"_checkForDeprecationHeader",value:function(e){var t=e.get("Alert");if(t){var r=void 0;try{r=JSON.parse(t)}catch(n){return void console.warn("Unable to parse Alert header message",t)}console.warn(r.message,r.url),this.events.emit("deprecated",r)}}},{key:"_checkForBackoffHeader",value:function(e,t){var r=void 0,n=parseInt(t.get("Backoff"),10);r=n>0?(new Date).getTime()+1e3*n:0,this.events.emit("backoff",r)}},{key:"_checkForRetryAfterHeader",value:function(e,t){var r=t.get("Retry-After");r&&(r=(new Date).getTime()+1e3*parseInt(r,10),this.events.emit("retry-after",r))}}]),e}();exports["default"]=HTTP;

},{"./errors":8}],10:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};require("isomorphic-fetch");var _events=require("events"),_base=require("./base"),_base2=_interopRequireDefault(_base),KintoClient=function(e){function t(e){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t);var n=o.events||new _events.EventEmitter;return _possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,Object.assign({events:n},o)))}return _inherits(t,e),t}(_base2["default"]);exports["default"]=KintoClient,"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=KintoClient);

},{"./base":3,"events":2,"isomorphic-fetch":1}],11:[function(require,module,exports){
"use strict";function safeHeader(e,t){return e?t?{"If-Match":'"'+t+'"'}:{"If-None-Match":"*"}:{}}function createRequest(e,t){var s=t.data,a=t.permissions,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=_extends({},requestDefaults,r),n=d.headers,u=d.safe;return{method:s&&s.id?"PUT":"POST",path:e,headers:_extends({},n,safeHeader(u)),body:{data:s,permissions:a}}}function updateRequest(e,t){var s=t.data,a=t.permissions,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],d=_extends({},requestDefaults,r),n=d.headers,u=d.safe,i=d.patch,o=_extends({},s,r),f=o.last_modified;return 0===Object.keys((0,_utils.omit)(s,"id","last_modified")).length&&(s=void 0),{method:i?"PATCH":"PUT",path:e,headers:_extends({},n,safeHeader(u,f)),body:{data:s,permissions:a}}}function deleteRequest(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=_extends({},requestDefaults,t),a=s.headers,r=s.safe,d=s.last_modified;if(r&&!d)throw new Error("Safe concurrency check requires a last_modified value.");return{method:"DELETE",path:e,headers:_extends({},a,safeHeader(r,d))}}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e};exports.createRequest=createRequest,exports.updateRequest=updateRequest,exports.deleteRequest=deleteRequest;var _utils=require("./utils"),requestDefaults={safe:!1,headers:{},permissions:void 0,data:void 0,patch:!1};

},{"./utils":12}],12:[function(require,module,exports){
"use strict";function partition(r,t){return 0>=t?r:r.reduce(function(r,e,n){return 0===n||n%t===0?r.push([e]):r[r.length-1].push(e),r},[])}function pMap(r,t){var e=[];return r.reduce(function(r,n){return r.then(function(){return Promise.resolve(t(n)).then(function(r){return e=e.concat(r)})})},Promise.resolve()).then(function(){return e})}function omit(r){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;t>n;n++)e[n-1]=arguments[n];return Object.keys(r).reduce(function(t,n){return-1===e.indexOf(n)&&(t[n]=r[n]),t},{})}function toDataBody(r){if(isObject(r))return r;if("string"==typeof r)return{id:r};throw new Error("Invalid argument.")}function qsify(r){var t="&",e=function(r){return encodeURIComponent("boolean"==typeof r?String(r):r)},n=function(r){return JSON.parse(JSON.stringify(r))},o=n(r);return Object.keys(o).map(function(r){var n=e(r)+"=";return Array.isArray(o[r])?o[r].map(function(r){return n+e(r)}).join(t):n+e(o[r])}).join(t)}function checkVersion(r,t,e){var n=function(r){return r.split(".").map(function(r){return parseInt(r,10)})},o=n(r),i=_slicedToArray(o,2),u=i[0],a=i[1],c=n(t),f=_slicedToArray(c,2),s=f[0],l=f[1],p=n(e),y=_slicedToArray(p,2),h=y[0],b=y[1],v=[s>u,u===s&&l>a,u>h,u===h&&a>=b];if(v.some(function(r){return r}))throw new Error("Version "+r+" doesn't satisfy "+(t+" <= x < "+e))}function support(r,t){return function(e,n,o){var i=o.value;return{configurable:!0,get:function(){var e=this,o=function(){for(var n=arguments.length,o=Array(n),u=0;n>u;u++)o[u]=arguments[u];var a="client"in e?e.client:e;return a.fetchHTTPApiVersion().then(function(e){return checkVersion(e,r,t)}).then(Promise.resolve(i.apply(e,o)))};return Object.defineProperty(this,n,{value:o,configurable:!0,writable:!0}),o}}}}function capable(r){return function(t,e,n){var o=n.value;return{configurable:!0,get:function(){var t=this,n=function(){for(var e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];var u="client"in t?t.client:t;return u.fetchServerCapabilities().then(function(t){var e=r.filter(function(r){return t.indexOf(r)<0});if(e.length>0)throw new Error("Required capabilities "+e.join(", ")+" not present on server")}).then(Promise.resolve(o.apply(t,n)))};return Object.defineProperty(this,e,{value:n,configurable:!0,writable:!0}),n}}}}function nobatch(r){return function(t,e,n){var o=n.value;return{configurable:!0,get:function(){var t=this,n=function(){for(var e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];if(t._isBatch)throw new Error(r);return o.apply(t,n)};return Object.defineProperty(this,e,{value:n,configurable:!0,writable:!0}),n}}}}function isObject(r){return"object"===("undefined"==typeof r?"undefined":_typeof(r))&&null!==r&&!Array.isArray(r)}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol?"symbol":typeof r},_slicedToArray=function(){function r(r,t){var e=[],n=!0,o=!1,i=void 0;try{for(var u,a=r[Symbol.iterator]();!(n=(u=a.next()).done)&&(e.push(u.value),!t||e.length!==t);n=!0);}catch(c){o=!0,i=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports.partition=partition,exports.pMap=pMap,exports.omit=omit,exports.toDataBody=toDataBody,exports.qsify=qsify,exports.checkVersion=checkVersion,exports.support=support,exports.capable=capable,exports.nobatch=nobatch,exports.isObject=isObject;

},{}]},{},[10])(10)
});